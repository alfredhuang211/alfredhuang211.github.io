<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>docker swarm mode 配置使用 | 个人学习记录</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="">
    <meta name="generator" content="Hugo 0.101.0" />
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    
    
    
      

    

    
    
    <meta property="og:title" content="docker swarm mode 配置使用" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://alfredhuang211.github.io/k8s/docker-swarm-mode-%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8/" /><meta property="article:section" content="k8s" />
<meta property="article:published_time" content="2022-06-27T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-06-27T00:00:00+00:00" />

<meta itemprop="name" content="docker swarm mode 配置使用">
<meta itemprop="description" content=""><meta itemprop="datePublished" content="2022-06-27T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-06-27T00:00:00+00:00" />
<meta itemprop="wordCount" content="615">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="docker swarm mode 配置使用"/>
<meta name="twitter:description" content=""/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        个人学习记录
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/" title="Home page">
              Home
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/hugo" title="Hugo page">
              Hugo
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/web3" title="Web 3.0 page">
              Web 3.0
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/k8s" title="Kubernetes page">
              Kubernetes
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/serverless" title="Serverless page">
              Serverless
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about" title="About page">
              About
            </a>
          </li>
          
        </ul>
      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">docker swarm mode 配置使用</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2022-06-27T00:00:00Z">June 27, 2022</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-solid serif f4 nested-links mid-gray pr4-l w-100-l"><h1 id="docker-swarm-mode-配置使用">docker swarm mode 配置使用</h1>
<h2 id="swarm-mode说明">swarm mode说明</h2>
<p>swarm mode 是 docker 在1.12版本中引入的集群配置工具,将原本的 docker swarm 集群配置工具直接集成在了 docker-engine 中.这种情况下,在只安装了docker-engine的情况下,都可以完成 docker 集群的组建和相应的操作.</p>
<h2 id="运行环境">运行环境</h2>
<p>ubuntu14.04.4</p>
<p>4.2.0 kernel</p>
<p>docker 1.12.0-rc2 (注意:在docker 1.12.0-rc1后才有swarm mode)</p>
<p>准备了ip分别为192.168.4.231/232/233的3台主机</p>
<p>此时查看 <code>docker info</code> 中, Swarm状态为inactive.</p>
<h2 id="创建集群">创建集群</h2>
<p>在主机231上执行 <code>docker swarm init --listen-addr 192.168.4.231:2377</code></p>
<p>此时通过 <code>docker info</code> 查看 Swarm 状态如下:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Swarm: active
</span></span><span style="display:flex;"><span> NodeID: 1lsp4r0esfl6a7vtg5hb02ztm
</span></span><span style="display:flex;"><span> IsManager: Yes
</span></span><span style="display:flex;"><span> Managers: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span> Nodes: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span> CACertHash: sha256:63030424e110733683d6f7543e3887f12021a1704592960e492a170144c025f5
</span></span></code></pre></div><p>通过 <code>docker node ls</code> 查看如下:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu231:~# docker node ls
</span></span><span style="display:flex;"><span>ID                           NAME       MEMBERSHIP  STATUS  AVAILABILITY  MANAGER STATUS
</span></span><span style="display:flex;"><span>1lsp4r0esfl6a7vtg5hb02ztm *  ubuntu231  Accepted    Ready   Active        Leader
</span></span></code></pre></div><p>通过 <code>docker swarm inspect</code> 查看如下:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu231:~# docker swarm inspect
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ID&#34;</span>: <span style="color:#e6db74">&#34;6toicfhqgbbjucri68f2pcgs2&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Version&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Index&#34;</span>: <span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;CreatedAt&#34;</span>: <span style="color:#e6db74">&#34;2016-07-04T12:07:56.816450141Z&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;UpdatedAt&#34;</span>: <span style="color:#e6db74">&#34;2016-07-04T12:07:56.996227642Z&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Spec&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;default&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;AcceptancePolicy&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Policies&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;Role&#34;</span>: <span style="color:#e6db74">&#34;worker&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;Autoaccept&#34;</span>: true
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;Role&#34;</span>: <span style="color:#e6db74">&#34;manager&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;Autoaccept&#34;</span>: false
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Orchestration&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;TaskHistoryRetentionLimit&#34;</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Raft&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;SnapshotInterval&#34;</span>: 10000,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;LogEntriesForSlowFollowers&#34;</span>: 500,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;HeartbeatTick&#34;</span>: 1,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;ElectionTick&#34;</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Dispatcher&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;HeartbeatPeriod&#34;</span>: <span style="color:#ae81ff">5000000000</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;CAConfig&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;NodeCertExpiry&#34;</span>: <span style="color:#ae81ff">7776000000000000</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><h2 id="节点加入集群">节点加入集群</h2>
<p>在232/233两主机上执行 <code>docker swarm join 192.168.4.231:2377</code></p>
<p>此时两主机上查看 <code>docker info</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Swarm: active
</span></span><span style="display:flex;"><span> NodeID: f51y1qkkarppreo9kt93f4zuy
</span></span><span style="display:flex;"><span> IsManager: No
</span></span></code></pre></div><p>此时两主机上查看 <code>docker node ls</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu233:~# docker node ls
</span></span><span style="display:flex;"><span>Error response from daemon: This node is not participating as a Swarm manager
</span></span></code></pre></div><p>在231上查看 <code>docker info</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Swarm: active
</span></span><span style="display:flex;"><span> NodeID: 1lsp4r0esfl6a7vtg5hb02ztm
</span></span><span style="display:flex;"><span> IsManager: Yes
</span></span><span style="display:flex;"><span> Managers: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span> Nodes: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span> CACertHash: sha256:63030424e110733683d6f7543e3887f12021a1704592960e492a170144c025f5
</span></span></code></pre></div><p>在231上查看 <code>docker node ls</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu231:~# docker node ls
</span></span><span style="display:flex;"><span>ID                           NAME       MEMBERSHIP  STATUS  AVAILABILITY  MANAGER STATUS
</span></span><span style="display:flex;"><span>1lsp4r0esfl6a7vtg5hb02ztm *  ubuntu231  Accepted    Ready   Active        Leader
</span></span><span style="display:flex;"><span>6dd63h58bw9vhuxp94208kq0a    ubuntu233  Accepted    Ready   Active        
</span></span><span style="display:flex;"><span>f51y1qkkarppreo9kt93f4zuy    ubuntu232  Accepted    Ready   Active        
</span></span></code></pre></div><p>在231上查看 <code>docker swarm inspect</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu231:~# docker swarm inspect
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ID&#34;</span>: <span style="color:#e6db74">&#34;6toicfhqgbbjucri68f2pcgs2&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Version&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Index&#34;</span>: <span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;CreatedAt&#34;</span>: <span style="color:#e6db74">&#34;2016-07-04T12:07:56.816450141Z&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;UpdatedAt&#34;</span>: <span style="color:#e6db74">&#34;2016-07-04T12:07:56.996227642Z&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Spec&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;default&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;AcceptancePolicy&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Policies&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;Role&#34;</span>: <span style="color:#e6db74">&#34;worker&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;Autoaccept&#34;</span>: true
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;Role&#34;</span>: <span style="color:#e6db74">&#34;manager&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;Autoaccept&#34;</span>: false
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Orchestration&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;TaskHistoryRetentionLimit&#34;</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Raft&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;SnapshotInterval&#34;</span>: 10000,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;LogEntriesForSlowFollowers&#34;</span>: 500,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;HeartbeatTick&#34;</span>: 1,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;ElectionTick&#34;</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Dispatcher&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;HeartbeatPeriod&#34;</span>: <span style="color:#ae81ff">5000000000</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;CAConfig&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;NodeCertExpiry&#34;</span>: <span style="color:#ae81ff">7776000000000000</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>可以看到 231 主机为 manager 节点,其他两个为 worker 节点.在 worker 节点上,无法查看 swarm node 信息.</p>
<h2 id="通过服务使用集群">通过服务使用集群</h2>
<p>在231,即 manager 节点上,通过执行如下命令启动一个服务.</p>
<p><code>docker service create --replicas 3 --name test busybox ping www.baidu.com </code></p>
<p>执行后通过 <code>docker service ls</code> 查看服务情况.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu231:~# docker service ls
</span></span><span style="display:flex;"><span>ID            NAME  REPLICAS  IMAGE    COMMAND
</span></span><span style="display:flex;"><span>52mpkhlszznu  test  3/3       busybox  ping www.baidu.com
</span></span></code></pre></div><p>可以看到此服务复制数为3.</p>
<p>分别在3台主机查看容器</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu231:~# docker ps
</span></span><span style="display:flex;"><span>CONTAINER ID        IMAGE               COMMAND                CREATED              STATUS              PORTS               NAMES
</span></span><span style="display:flex;"><span>4c2c3d36ee0d        busybox:latest      <span style="color:#e6db74">&#34;ping www.baidu.com&#34;</span>   About a minute ago   Up About a minute                       test.1.bx4hz20s11msmlp04w3uerg18
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu232:~# docker ps
</span></span><span style="display:flex;"><span>CONTAINER ID        IMAGE               COMMAND                CREATED              STATUS              PORTS               NAMES
</span></span><span style="display:flex;"><span>5fb24cf0ff0e        busybox:latest      <span style="color:#e6db74">&#34;ping www.baidu.com&#34;</span>   About a minute ago   Up About a minute                       test.3.358cfwsw2ty2brt5ve045r61b
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu233:~# docker ps
</span></span><span style="display:flex;"><span>CONTAINER ID        IMAGE               COMMAND                CREATED              STATUS              PORTS               NAMES
</span></span><span style="display:flex;"><span>104191844da9        busybox:latest      <span style="color:#e6db74">&#34;ping www.baidu.com&#34;</span>   About a minute ago   Up About a minute                       test.2.971p65qenkoqdo6hpvkq9f5id
</span></span></code></pre></div><p>可以看到此服务的容器被平均分布到3台主机上去运行了.</p>
<p>也可以通过在 manager 节点上执行 <code>docker service tasks test</code> 查看此服务任务的分布情况.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu231:~# docker service tasks test
</span></span><span style="display:flex;"><span>ID                         NAME    SERVICE  IMAGE    LAST STATE         DESIRED STATE  NODE
</span></span><span style="display:flex;"><span>bx4hz20s11msmlp04w3uerg18  test.1  test     busybox  Running <span style="color:#ae81ff">5</span> minutes  Running        ubuntu231
</span></span><span style="display:flex;"><span>971p65qenkoqdo6hpvkq9f5id  test.2  test     busybox  Running <span style="color:#ae81ff">5</span> minutes  Running        ubuntu233
</span></span><span style="display:flex;"><span>358cfwsw2ty2brt5ve045r61b  test.3  test     busybox  Running <span style="color:#ae81ff">5</span> minutes  Running        ubuntu232
</span></span></code></pre></div><p>在使用 service 服务的时候,每台主机上的 docker run 还是可以一样正常使用.</p>
<h2 id="服务规模调整">服务规模调整</h2>
<p>在 manager 节点上执行命令 <code>docker service scale test=5</code> 即可完成服务扩容.此处是将test 服务的容器数扩容到 5.</p>
<p>通过 <code>docker service tasks test</code> 查看服务:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu231:~# docker service tasks test
</span></span><span style="display:flex;"><span>ID                         NAME    SERVICE  IMAGE    LAST STATE          DESIRED STATE  NODE
</span></span><span style="display:flex;"><span>bx4hz20s11msmlp04w3uerg18  test.1  test     busybox  Running <span style="color:#ae81ff">15</span> minutes  Running        ubuntu231
</span></span><span style="display:flex;"><span>971p65qenkoqdo6hpvkq9f5id  test.2  test     busybox  Running <span style="color:#ae81ff">15</span> minutes  Running        ubuntu233
</span></span><span style="display:flex;"><span>358cfwsw2ty2brt5ve045r61b  test.3  test     busybox  Running <span style="color:#ae81ff">15</span> minutes  Running        ubuntu232
</span></span><span style="display:flex;"><span>b1cu1mwnw98oymi1vgbcl3l84  test.4  test     busybox  Running <span style="color:#ae81ff">20</span> seconds  Running        ubuntu232
</span></span><span style="display:flex;"><span>7t8kfpfv4zegut9fbc1bbwaf6  test.5  test     busybox  Running <span style="color:#ae81ff">20</span> seconds  Running        ubuntu231
</span></span></code></pre></div><p>可以看到在经过一段时间后,此服务的容器数扩展到5个,并调度到不同主机上.</p>
<p>同理, 通过 <code>docker service scale test=2</code> 此命令指定不同的 scale 数,可以随意控制服务的容器数量.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu231:~# docker service tasks test
</span></span><span style="display:flex;"><span>ID                         NAME    SERVICE  IMAGE    LAST STATE          DESIRED STATE  NODE
</span></span><span style="display:flex;"><span>358cfwsw2ty2brt5ve045r61b  test.3  test     busybox  Running <span style="color:#ae81ff">17</span> minutes  Running        ubuntu232
</span></span><span style="display:flex;"><span>7t8kfpfv4zegut9fbc1bbwaf6  test.5  test     busybox  Running <span style="color:#ae81ff">2</span> minutes   Running        ubuntu231
</span></span></code></pre></div><p>缩容的话, docker 会随机选择容器关闭.</p>
<h2 id="服务移除">服务移除</h2>
<p>通过 <code>docker service rm test</code> 即可移除服务. 当移除服务后, 每台主机上相关的容器也就被移除了.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://alfredhuang211.github.io/" >
    &copy;  个人学习记录 2022 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
